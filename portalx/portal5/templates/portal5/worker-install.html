{% extends 'components/html.html' %}

{% set title = 'portal5 init' %}

{% block styles %}
{{ super() }}
<style>
    #worker-failed,
    #worker-unavailable {
        display: none;
    }
</style>
{% endblock %}

{% block scripts %}
<script async src="/install.js"></script>
<script>
    const settings = JSON.parse('{{ worker_settings|tojson }}');
</script>
{% endblock %}

{% set use_portal3 %}
<li>
    {{_( 'Use' )}} <code><em>portal3</em></code>{{_( ', a previous version of this tool that relies on cookies for redirection.' )}}
    <br>
    â†’ <code><strong><a href="//portal3.{{ g.sld }}/{{ remote }}">{{ request.scheme }}://portal3.{{ g.sld }}/{{ remote }}</a></strong></code>
</li>
{% endset %}

{% block body %}
<main>
    <article>
        <h1><code>portal5</code></h1>
        <blockquote>
            <pre><code id="console"></code></pre>
        </blockquote>

        <div id="worker-failed">
            <h3>{{_('Failed to initialize Service Worker')}}</h3>
            <p>
                <code>portal5</code> {{_('relies on a web technology called')}}
                <strong><a href="https://developers.google.com/web/fundamentals/primers/service-workers" target="_blank">Service Worker</a></strong>
                {{_('to work, which failed to initialize. The reason, if any, is displayed above.')}}
            </p>
            <p>{{_('You may:')}}</p>
            <ul>
                <li>{{ _('Try clearing cookies and data for this website.') }}</li>
                <li>{{ _('Try visiting this page later.') }}</li>
                {{ use_portal3 }}
            </ul>
        </div>

        <div id="worker-unavailable">
            <h3>{{_('Service Worker API unavailable')}}</h3>
            <p>
                <code>portal5</code> {{_('relies on a web technology called')}}
                <strong><a href="https://developers.google.com/web/fundamentals/primers/service-workers" target="_blank">Service Worker</a></strong>
                {{_('to work, which is not supported by your browser.')}} 
                <em>{{_('(Note: Firefox disables Service Workers in Private Browsing mode)')}} </em>
                {% if browser_additional %}
                <em>{{_('(If you are viewing this in WeChat, please open this page in your browser)')}}</em>
                {% endif %}
            </p>
            <p>{{_('You may:')}}</p>
            <ul>
                <li>{{_('Switch to a another browser.')}}</li>
                {{ use_portal3 }}
            </ul>
        </div>

        <noscript>
            <div id="worker-noscript">
                <h3>{{_('JavaScript is not enabled')}}</h3>
                <p><code>portal5</code> {{_('requires')}} <strong>JavaScript</strong> {{_('to work.')}}</p>
            </div>
            <p>{{_('You may:')}}</p>
            <ul>
                <li>{{_('Enable JavaScript in your browser, or switch to a newer browser.')}}</li>
                {{ use_portal3 }}
            </ul>
        </noscript>
    </article>
</main>
{% endblock %}